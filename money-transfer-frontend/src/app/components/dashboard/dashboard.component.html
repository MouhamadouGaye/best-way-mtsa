<div class="dashboard">
  <!-- Sidebar -->
  <aside class="sidebar">
    <h2 class="logo">ðŸ’¸ MoneyApp</h2>
    <nav>
      <a routerLink="/dashboard" routerLinkActive="active">Dashboard</a>
      <a routerLink="/history" routerLinkActive="active">Transactions</a>
      <a routerLink="/profile" routerLinkActive="active">Profile</a>
    </nav>
  </aside>

  <!-- Main -->
  <main class="main">
    <!-- Balance card -->
    <section class="card balance">
      <h3>Current Balance</h3>
      <p class="amount">{{ balance | currency : senderCurrency }}</p>
    </section>

    <!-- Transfer card -->
    <section class="card transfer">
      <h3>Send Money</h3>

      <!-- Country selector -->
      <div class="dropdown-wrapper" (click)="$event.stopPropagation()">
        <input
          type="text"
          placeholder="Select destination country"
          [(ngModel)]="selectedCountry"
          (input)="filterCountries()"
          (focus)="onDropdownMenu('country', $event)"
        />
        <ul *ngIf="openDropdown === 'country' && filteredCountries.length > 0">
          <li *ngFor="let c of filteredCountries" (click)="chooseCountry(c)">
            <div class="country-dropdown">
              <span class="flag">{{ c.flag }}</span>
              <span class="name"> {{ c.name }} </span>
              <span class="currency">{{ c.currency }}</span>
            </div>
          </li>
        </ul>
      </div>

      <!-- Beneficiary selector -->
      <div class="dropdown-wrapper" (click)="$event.stopPropagation()">
        <input
          type="text"
          placeholder="Recipient name or phone"
          [(ngModel)]="selectedBeneficiary"
          (input)="filterBeneficiaries()"
          (focus)="onDropdownMenu('beneficiary', $event)"
        />
        <ul
          *ngIf="openDropdown === 'beneficiary' && filteredBeneficiaries.length"
        >
          <li
            *ngFor="let b of filteredBeneficiaries"
            (click)="chooseBeneficiary(b)"
          >
            <div class="beneficiary-dropdown">
              <span class="flag">{{ b.flag }}</span>
              <span class="name"> {{ b.fullName }} </span>
              <span class="phone-number">{{ b.phoneNumber }}</span>
            </div>
          </li>
        </ul>
      </div>

      <!-- Add beneficiary toggle -->
      <button
        type="button"
        class="add-btn"
        (click)="showAddBeneficiary = !showAddBeneficiary"
      >
        + Add Beneficiary
      </button>

      <div
        class="beneficiary-overlay"
        *ngIf="showAddBeneficiary"
        (click)="closeModal()"
      >
        <div class="form-base" (click)="$event.stopPropagation()">
          <h3>Add Beneficiary</h3>
          <span class="del-modal" (click)="closeModal()">â¨‰</span>
          <div class="add-beneficiary-form">
            <input
              type="text"
              placeholder="Full Name"
              [(ngModel)]="newBeneficiary.fullName"
            />
            <input
              type="text"
              placeholder="Phone Number"
              [(ngModel)]="newBeneficiary.phoneNumber"
            />
            <input
              type="email"
              placeholder="Email (optional)"
              [(ngModel)]="newBeneficiary.email"
            />
            <button
              type="button"
              (click)="addBeneficiary()"
              [disabled]="loading"
            >
              Add
            </button>
          </div>
        </div>
      </div>

      <!-- Amount inputs -->
      <div class="currency-inputs">
        <input
          type="number"
          placeholder="Amount ({{ senderCurrency }})"
          [(ngModel)]="amountSender"
          (input)="updateConvertedAmount('sender')"
        />
        <input
          type="number"
          placeholder="Converted ({{ receiverCurrency || '?' }})"
          [(ngModel)]="amountReceiver"
          (input)="updateConvertedAmount('receiver')"
        />
        <span>{{ receiverCurrency }}</span>
      </div>

      <!-- Card inputs -->
      <div class="card-form">
        <input
          type="text"
          placeholder="Card Number"
          [(ngModel)]="cardInfo.cardNumber"
        />
        <input
          type="text"
          placeholder="Expiry Month"
          [(ngModel)]="cardInfo.expiryMonth"
        />
        <input
          type="text"
          placeholder="Expiry Year"
          [(ngModel)]="cardInfo.expiryYear"
        />
        <input type="text" placeholder="CVV" [(ngModel)]="cardInfo.cvv" />
      </div>

      <button type="button" (click)="sendTransfer()" [disabled]="loading">
        Send
      </button>

      <p class="success" *ngIf="success">{{ success }}</p>
      <p class="error" *ngIf="error">{{ error }}</p>
    </section>

    <!-- Recent transfers -->
    <section class="card history">
      <h3>Recent Transfers</h3>
      <div *ngFor="let t of recentTransfers" class="history-item">
        <div class="left">
          <span class="to">To: {{ t.toUser.username }}</span>
          <span class="status" [ngClass]="t.status.toLowerCase()">{{
            t.status
          }}</span>
        </div>
        <div class="right">
          <span class="amount">{{ t.amount | currency : senderCurrency }}</span>
        </div>
      </div>
    </section>
  </main>
</div>
